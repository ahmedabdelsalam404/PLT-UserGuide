name: Convert Word Doc to SVGs and Commit Artifacts

on:
  schedule:
    - cron: "0 6 * * *"  # Every day at 6 AM UTC
  workflow_dispatch:

jobs:
  convert:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repo
      uses: actions/checkout@v3

    - name: Install LibreOffice and Poppler
      run: |
        sudo apt-get update
        sudo apt-get install -y libreoffice poppler-utils

    - name: Download Word File from SharePoint
      run: |
        curl -L "https://nymta.sharepoint.com/:w:/s/COEReporting/EXx9UEDdHkZFoS0LPvNCUjsB5KEy-pkA2UhhTXR6RuRRlA?e=zhOTmI&download=1" -o PLT-Metrics-Guide.docx

    - name: Convert DOCX to PDF
      run: libreoffice --headless --convert-to pdf "PLT-Metrics-Guide.docx" --outdir .

    - name: Convert PDF Pages to SVGs
      run: |
        mkdir -p svg_pages
        pdftocairo -svg PLT-Metrics-Guide.pdf svg_pages/page

    - name: Commit and Push Artifacts (DOCX, PDF, SVGs)
      env:
        TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        git config user.name "github-actions"
        git config user.email "github-actions@github.com"
        git remote set-url origin https://x-access-token:$TOKEN@github.com/${{ github.repository }}
        git pull origin main --rebase
        git add PLT-Metrics-Guide.docx || true
        git add PLT-Metrics-Guide.pdf || true
        git add svg_pages/ || true
        git commit -m "âœ… Daily doc refresh: .docx, .pdf, SVGs" || echo "Nothing to commit"
        git push origin HEAD:main
