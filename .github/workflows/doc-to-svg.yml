name: Convert Word Doc to PDF and SVGs

on:
  schedule:
    - cron: "0 6 * * *" # Every day at 6 AM UTC
  workflow_dispatch:     # Manual trigger

jobs:
  convert-doc:
    runs-on: ubuntu-latest

    steps:
    - name: üì• Checkout Repo
      uses: actions/checkout@v3

    - name: üõ† Install LibreOffice and Poppler
      run: |
        sudo apt-get update
        sudo apt-get install -y libreoffice poppler-utils

    - name: üßæ Convert .docx to .pdf
      run: |
        libreoffice --headless --convert-to pdf "PLT-Metrics-Guide.docx" --outdir .

    - name: üì§ Convert PDF to SVG pages
      run: |
        mkdir -p svg_pages
        if [ -f "PLT-Metrics-Guide.pdf" ]; then
          echo "‚úÖ PDF found. Starting SVG conversion..."

          # Get page count from pdfinfo
          PAGES=$(pdfinfo PLT-Metrics-Guide.pdf | grep Pages | awk '{print $2}')
          echo "PDF has $PAGES pages"

          # Run conversion (force page range)
          pdftocairo -svg -f 1 -l $PAGES PLT-Metrics-Guide.pdf svg_pages/page

          echo "‚úÖ SVGs generated:"
          ls -lh svg_pages/
        else
          echo "‚ùå PDF not found!"
          exit 1
        fi


    - name: üöÄ Commit .pdf and .svg files
      env:
        TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        git config user.name "github-actions"
        git config user.email "github-actions@github.com"

        # Authenticate
        git remote set-url origin https://x-access-token:$TOKEN@github.com/${{ github.repository }}

        # Stash local changes before pulling
        git stash --include-untracked

        # Pull latest from main with rebase
        git pull origin main --rebase

        # Restore stashed files
        git stash pop || echo "Nothing to pop"

        # Stage and commit
        git add -A
        git commit -m "üìÑ Auto-convert Word doc to PDF and SVGs" || echo "Nothing to commit"

        # Push changes
        git push origin HEAD:main
