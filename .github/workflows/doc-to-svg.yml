name: Convert Word Doc to PDF and SVGs

on:
  schedule:
    - cron: "0 6 * * *" # Every day at 6 AM UTC
  workflow_dispatch:     # Manual trigger

jobs:
  convert-doc:
    runs-on: ubuntu-latest

    steps:
    - name: ðŸ“¥ Checkout Repo
      uses: actions/checkout@v3

    - name: ðŸ›  Install LibreOffice and Poppler
      run: |
        sudo apt-get update
        sudo apt-get install -y libreoffice poppler-utils

    - name: ðŸ§¾ Convert .docx to .pdf
      run: |
        libreoffice --headless --convert-to pdf "PLT-Metrics-Guide.docx" --outdir .

    - name: ðŸ“¤ Convert .pdf to .svg pages
      run: |
        mkdir -p svg_pages
        pdftocairo -svg PLT-Metrics-Guide.pdf svg_pages/page

    - name: ðŸš€ Commit .pdf and .svg files
      env:
        TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        git config user.name "github-actions"
        git config user.email "github-actions@github.com"

        # Authenticate
        git remote set-url origin https://x-access-token:$TOKEN@github.com/${{ github.repository }}

        # Stash local changes before pulling
        git stash --include-untracked

        # Pull latest from main with rebase
        git pull origin main --rebase

        # Restore stashed files
        git stash pop || echo "Nothing to pop"

        # Stage and commit
        git add -A
        git commit -m "ðŸ“„ Auto-convert Word doc to PDF and SVGs" || echo "Nothing to commit"

        # Push changes
        git push origin HEAD:main
